{{#> layouts/main}}
  <div class="header bg-primary pb-6">
    <div class="container-fluid">
      <div class="header-body">
        <div class="row align-items-center py-4">
          <div class="col-lg-6 col-7">
            <h6 class="h2 text-white d-inline-block mb-0">Find Package</h6>
            <nav aria-label="breadcrumb" class="d-none d-md-inline-block ml-md-4">
              <ol class="breadcrumb breadcrumb-links breadcrumb-dark">
                <li class="breadcrumb-item"><a href="/"><i class="fas fa-home"></i></a></li>
                <li class="breadcrumb-item active" aria-current="page">Find Package</li>
              </ol>
            </nav>
          </div>
          <!-- <div class="col-lg-6 col-5 text-right">
            <a href="#" class="btn btn-sm btn-neutral">New</a>
            <a href="#" class="btn btn-sm btn-neutral">Filters</a>
          </div> -->
        </div>
      </div>
    </div>
  </div>
  <!-- Page content -->
  <div class="container-fluid mt--6">
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-header border-0" style="display: block ruby;">
            <h3 class="mb-0" style="width: 75%; line-height: 230%;">Packages</h3>
            <input type="text" placeholder="Search" id="search" onkeyup="tableLookup(this)" style="border-radius: 5px; border: 1px solid lightgray; float: right; width: 25%; padding: 5px;">
          </div>
          <div class="table-responsive">
            <!-- may be useful to add this later: <div>
              <div class="progress">
                <div class="progress-bar bg-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"></div>
              </div>
            </div> -->
            <table class="table align-items-center table-flush" id="table">
              <thead class="thead-light">
                <tr>
                  {{#each packages.headers}}
                  <th scope="col" class="sort" data-sort="name">{{this}}</th>
                  {{/each}}
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody class="list">
                {{#each packages.rows}}
                {{#ifOverFive @index}}
                <tr style="display: none" id="table-row-{{@index}}">
                  <td scope="row">{{this.recipient}}</td>
                  <td>{{this.sender}}</td>
                  <td>{{this.carrierName}}</td>
                  <td>{{this.returnAddress}}</td>
                  <td>{{this.recipientAddress}}</td>
                  <td>{{this.trackingNumber}}</td>
                </tr>
                {{else}}
                <tr id="table-row-{{@index}}">
                  <td scope="row">{{this.recipient}}</td>
                  <td>{{this.sender}}</td>
                  <td>{{this.carrierName}}</td>
                  <td>{{this.returnAddress}}</td>
                  <td>{{this.recipientAddress}}</td>
                  <td>{{this.trackingNumber}}</td>
                </tr>
                {{/ifOverFive}}
                {{/each}}
              </tbody>
            </table>
          </div>
          <!-- Card footer -->
          <div class="card-footer py-4">
            <nav aria-label="...">
              <ul class="pagination justify-content-end mb-0" id="table-pages">
                <li class="page-item">
                  <a class="page-link" onclick="changeTablePage(this)">
                    <i class="fas fa-angle-left"></i>
                    <span class="sr-only">Previous</span>
                  </a>
                </li>
                <li class="page-item active">
                  <a class="page-link" id="page-link-1" onclick="changeTablePage(this)">1</a>
                </li>
                {{#each packages.rows}}
                {{#ifModFive @index}}
                <li class="page-item">
                  <a class="page-link" id="page-link-{{paginateByFive @index}}" onclick="changeTablePage(this)">{{paginateByFive @index}}</a>
                </li>
                {{/ifModFive}}
                {{/each}}
                <li class="page-item">
                  <a class="page-link" onclick="changeTablePage(this)">
                    <i class="fas fa-angle-right"></i>
                    <span class="sr-only">Next</span>
                  </a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer -->
    <!-- <footer class="footer pt-0">
      <div class="row align-items-center justify-content-lg-between">
        <div class="col-lg-6">
          <div class="copyright text-center  text-lg-left  text-muted">
            &copy; 2020 <a href="https://www.creative-tim.com" class="font-weight-bold ml-1" target="_blank">Creative Tim</a>
          </div>
        </div>
        <div class="col-lg-6">
          <ul class="nav nav-footer justify-content-center justify-content-lg-end">
            <li class="nav-item">
              <a href="https://www.creative-tim.com" class="nav-link" target="_blank">Creative Tim</a>
            </li>
            <li class="nav-item">
              <a href="https://www.creative-tim.com/presentation" class="nav-link" target="_blank">About Us</a>
            </li>
            <li class="nav-item">
              <a href="http://blog.creative-tim.com" class="nav-link" target="_blank">Blog</a>
            </li>
            <li class="nav-item">
              <a href="https://github.com/creativetimofficial/argon-dashboard/blob/master/LICENSE.md" class="nav-link" target="_blank">MIT License</a>
            </li>
          </ul>
        </div>
      </div>
    </footer> -->
  </div>
  <script>
  function hideRows(tr, filter = "", min = 0, max = 5) {
    let rows = [];
    for (let i = 1; i < tr.length; i++) {
      tr[i].style.display = "none";
      let tds = tr[i].getElementsByTagName("td");
      if (tds) {
        for (let j = 0; j < tds.length; j++) {
          if (tds[j]) {
            txtValue = tds[j].textContent || tds[j].innerText;
            if (txtValue.toUpperCase().indexOf(filter) > -1) {
              rows.push(tr[i]);
              break;
            }
          }
        }
      }
    }
    if (max > rows.length) {
      max = rows.length;
    }
    for (let i = min; i < max; i++) {
      if (rows[i]) {
        rows[i].style.display = "";
      }
    }
    let tablePages = document.getElementById('table-pages');
    tablePages.innerHTML = "";
    tablePages.innerHTML += `<li class="page-item">
      <a class="page-link" onclick="changeTablePage(this)">
        <i class="fas fa-angle-left"></i>
        <span class="sr-only">Previous</span>
      </a>`;
    for (let i = 0; i < (rows.length / 5); i++) {
      if (i === 0) {
        tablePages.innerHTML += `<li class="page-item active">
          <a class="page-link" id="page-link-${i + 1}" onclick="changeTablePage(this)">${i + 1}</a>
        </li>`
      } else {
        tablePages.innerHTML += `<li class="page-item">
          <a class="page-link" id="page-link-${i + 1}" onclick="changeTablePage(this)">${i + 1}</a>
        </li>`
      }
    }
    tablePages.innerHTML += `<li class="page-item">
      <a class="page-link" onclick="changeTablePage(this)">
        <i class="fas fa-angle-right"></i>
        <span class="sr-only">Next</span>
      </a>
    </li>`;
  }
  function changeTablePage(elem) {
    let min;
    let max;
    let num = 0;
    let pageItems = document.getElementsByClassName('page-item');
    let node = document.getElementsByClassName('page-item active')[0].querySelector('.page-link');
    if (pageItems[1].querySelector('.page-link').isEqualNode(node) && pageItems[0].querySelector('.page-link').isEqualNode(elem)) {
      return;
    }else if (pageItems[pageItems.length - 2].querySelector('.page-link').isEqualNode(node) && pageItems[pageItems.length - 1].querySelector('.page-link').isEqualNode(elem)) {
      return;
    }
    if (Number(elem.innerHTML)) {
      min = Math.floor((Number(elem.innerHTML) - 1) * 5);
      max = Math.floor(Number(elem.innerHTML) * 5);
    } else {
      let item = elem;
      elem = document.getElementsByClassName('page-item active')[0].querySelector('.page-link');
      if (pageItems[0].querySelector('.page-link').isEqualNode(item)) {
        num = -1;
      } else if (pageItems[pageItems.length - 1].querySelector('.page-link').isEqualNode(item)) {
        num = 1;
      }
      min = Math.floor((Number(elem.innerHTML) + num - 1) * 5);
      max = Math.floor((Number(elem.innerHTML) + num) * 5);
    }
    tr = table.getElementsByTagName("tr");

    hideRows(tr, document.getElementById('search').value.toUpperCase(), min, max)

    for (let i = 0; i < pageItems.length; i++) {
      pageItems[i].className = "page-item";
    }
    pageItems[Number(elem.innerHTML) + num].className = "page-item active";
  }
  function tableLookup(input) {
    let filter, tr, td, txtValue;
    filter = input.value.toUpperCase();
    table = document.getElementById('table')
    tr = table.getElementsByTagName("tr");

    hideRows(tr, filter)
  }
  </script>
{{/layouts/main}}
